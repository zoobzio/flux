---
title: Signals Reference
description: Capitan signal definitions for flux observability.
author: Flux Team
published: 2025-12-03
tags: [Reference, Signals, Observability, Capitan]
---

# Signals Reference

Flux emits capitan signals for all lifecycle events, enabling observability, monitoring, and alerting.

## Signal Definitions

### CapacitorStarted

```go
var CapacitorStarted = capitan.NewSignal(
    "flux.capacitor.started",
    "Capacitor watching started",
)
```

Emitted when `Start()` is called and watching begins.

**Fields:**
- `KeyWatcherType` - Type name of the watcher implementation
- `KeyDebounce` - Configured debounce duration

**Example:**
```go
capitan.Hook(flux.CapacitorStarted, func(ctx context.Context, e *capitan.Event) {
    log.Printf("Started watching with %s, debounce=%v",
        flux.KeyWatcherType.Extract(e),
        flux.KeyDebounce.Extract(e),
    )
})
```

---

### CapacitorStopped

```go
var CapacitorStopped = capitan.NewSignal(
    "flux.capacitor.stopped",
    "Capacitor watching stopped",
)
```

Emitted when watching stops (context cancelled or watcher channel closed).

**Fields:**
- `KeyState` - Final state when stopped

**Example:**
```go
capitan.Hook(flux.CapacitorStopped, func(ctx context.Context, e *capitan.Event) {
    log.Printf("Stopped in state: %s", flux.KeyState.Extract(e))
})
```

---

### CapacitorStateChanged

```go
var CapacitorStateChanged = capitan.NewSignal(
    "flux.capacitor.state.changed",
    "Capacitor state transition",
)
```

Emitted on every state transition.

**Fields:**
- `KeyOldState` - Previous state
- `KeyNewState` - New state

**Example:**
```go
capitan.Hook(flux.CapacitorStateChanged, func(ctx context.Context, e *capitan.Event) {
    old := flux.KeyOldState.Extract(e)
    new := flux.KeyNewState.Extract(e)
    log.Printf("State: %s → %s", old, new)

    // Alert on degradation
    if new == flux.StateDegraded.String() {
        alerting.Send("Config degraded")
    }
})
```

---

### CapacitorChangeReceived

```go
var CapacitorChangeReceived = capitan.NewSignal(
    "flux.capacitor.change.received",
    "Raw change received from watcher",
)
```

Emitted when raw data is received from the watcher (before transform/validate/apply).

**Fields:** None

**Example:**
```go
capitan.Hook(flux.CapacitorChangeReceived, func(ctx context.Context, e *capitan.Event) {
    metrics.Increment("config_changes_received")
})
```

---

### CapacitorTransformFailed

```go
var CapacitorTransformFailed = capitan.NewSignal(
    "flux.capacitor.transform.failed",
    "Transform function failed",
)
```

Emitted when the transform function returns an error.

**Fields:**
- `KeyError` - Error message

**Example:**
```go
capitan.Hook(flux.CapacitorTransformFailed, func(ctx context.Context, e *capitan.Event) {
    log.Printf("Parse error: %s", flux.KeyError.Extract(e))
    metrics.Increment("config_parse_errors")
})
```

---

### CapacitorValidationFailed

```go
var CapacitorValidationFailed = capitan.NewSignal(
    "flux.capacitor.validation.failed",
    "Validation failed",
)
```

Emitted when the validate function returns an error.

**Fields:**
- `KeyError` - Error message

**Example:**
```go
capitan.Hook(flux.CapacitorValidationFailed, func(ctx context.Context, e *capitan.Event) {
    log.Printf("Validation error: %s", flux.KeyError.Extract(e))
    metrics.Increment("config_validation_errors")
})
```

---

### CapacitorApplyFailed

```go
var CapacitorApplyFailed = capitan.NewSignal(
    "flux.capacitor.apply.failed",
    "Apply function failed",
)
```

Emitted when the apply function returns an error.

**Fields:**
- `KeyError` - Error message

**Example:**
```go
capitan.Hook(flux.CapacitorApplyFailed, func(ctx context.Context, e *capitan.Event) {
    log.Printf("Apply error: %s", flux.KeyError.Extract(e))
    metrics.Increment("config_apply_errors")
})
```

---

### CapacitorApplySucceeded

```go
var CapacitorApplySucceeded = capitan.NewSignal(
    "flux.capacitor.apply.succeeded",
    "Config applied successfully",
)
```

Emitted when configuration is successfully applied.

**Fields:** None

**Example:**
```go
capitan.Hook(flux.CapacitorApplySucceeded, func(ctx context.Context, e *capitan.Event) {
    log.Println("Config applied successfully")
    metrics.Increment("config_applies_succeeded")
})
```

---

## Field Keys

### KeyState

```go
var KeyState = capitan.NewStringKey("state")
```

Current state of the Capacitor.

### KeyOldState

```go
var KeyOldState = capitan.NewStringKey("old_state")
```

Previous state before a transition.

### KeyNewState

```go
var KeyNewState = capitan.NewStringKey("new_state")
```

New state after a transition.

### KeyError

```go
var KeyError = capitan.NewStringKey("error")
```

Error message when an operation fails.

### KeyDebounce

```go
var KeyDebounce = capitan.NewDurationKey("debounce")
```

Configured debounce duration.

### KeyWatcherType

```go
var KeyWatcherType = capitan.NewStringKey("watcher_type")
```

Type name of the watcher implementation.

---

## Complete Observability Setup

```go
func setupObservability() {
    // Lifecycle events
    capitan.Hook(flux.CapacitorStarted, func(ctx context.Context, e *capitan.Event) {
        log.Printf("[FLUX] Started: watcher=%s debounce=%v",
            flux.KeyWatcherType.Extract(e),
            flux.KeyDebounce.Extract(e),
        )
    })

    capitan.Hook(flux.CapacitorStopped, func(ctx context.Context, e *capitan.Event) {
        log.Printf("[FLUX] Stopped: state=%s", flux.KeyState.Extract(e))
    })

    // State tracking
    capitan.Hook(flux.CapacitorStateChanged, func(ctx context.Context, e *capitan.Event) {
        old := flux.KeyOldState.Extract(e)
        new := flux.KeyNewState.Extract(e)
        log.Printf("[FLUX] State: %s → %s", old, new)

        metrics.Gauge("config_state", stateToNumber(new))

        if new == flux.StateDegraded.String() {
            alerting.Send(alert{
                Severity: "warning",
                Title:    "Configuration Degraded",
                Message:  "Config update failed, using previous version",
            })
        }

        if old == flux.StateDegraded.String() && new == flux.StateHealthy.String() {
            alerting.Resolve("config_degraded")
        }
    })

    // Change tracking
    capitan.Hook(flux.CapacitorChangeReceived, func(ctx context.Context, e *capitan.Event) {
        metrics.Increment("config_changes_total")
    })

    // Error tracking
    capitan.Hook(flux.CapacitorTransformFailed, func(ctx context.Context, e *capitan.Event) {
        log.Printf("[FLUX] Transform failed: %s", flux.KeyError.Extract(e))
        metrics.Increment("config_errors_total", "stage", "transform")
    })

    capitan.Hook(flux.CapacitorValidationFailed, func(ctx context.Context, e *capitan.Event) {
        log.Printf("[FLUX] Validation failed: %s", flux.KeyError.Extract(e))
        metrics.Increment("config_errors_total", "stage", "validate")
    })

    capitan.Hook(flux.CapacitorApplyFailed, func(ctx context.Context, e *capitan.Event) {
        log.Printf("[FLUX] Apply failed: %s", flux.KeyError.Extract(e))
        metrics.Increment("config_errors_total", "stage", "apply")
    })

    // Success tracking
    capitan.Hook(flux.CapacitorApplySucceeded, func(ctx context.Context, e *capitan.Event) {
        log.Println("[FLUX] Config applied successfully")
        metrics.Increment("config_applies_total")
    })
}

func stateToNumber(state string) float64 {
    switch state {
    case "healthy":
        return 1
    case "degraded":
        return 0.5
    case "empty":
        return 0
    case "loading":
        return -1
    default:
        return -2
    }
}
```

---

## Using Observers

For audit logging, use a capitan observer to capture all flux events:

```go
func setupAuditLog() {
    capitan.Observe(func(ctx context.Context, e *capitan.Event) {
        sig := e.Signal()
        if strings.HasPrefix(sig.Name(), "flux.") {
            audit.Log(audit.Entry{
                Timestamp: time.Now(),
                Signal:    sig.Name(),
                Fields:    extractFields(e),
            })
        }
    })
}
```
